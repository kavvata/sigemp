<tbody id="tbody"
       class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
    {% for emprestimo in emprestimos %}
        <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
            <td class="px-6 py-4">
                <div x-data="{ open: false }"
                     class="relative flex justify-end"
                     @click.outside="open = false">
                    <!-- Ellipsis Button -->
                    <button @click="open = !open"
                            class="p-2 text-gray-500 hover:text-blue-600 transition-colors duration-200 dark:text-gray-400 dark:hover:text-blue-400 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700"
                            title="Ações">
                        <i class="material-symbols-outlined text-lg">more_vert</i>
                    </button>
                    <!-- Floating Menu -->
                    <div x-show="open"
                         x-transition:enter="transition ease-out duration-100"
                         x-transition:enter-start="transform opacity-0 scale-95"
                         x-transition:enter-end="transform opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-75"
                         x-transition:leave-start="transform opacity-100 scale-100"
                         x-transition:leave-end="transform opacity-0 scale-95"
                         class="absolute left-0 top-full mt-1 w-40 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 py-1">
                        <button @click="open = false; $dispatch('open-modal', { url: '{% url 'emprestimo:editar_emprestimo' emprestimo.id %}' })"
                                class="w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 text-left">
                            <i class="material-symbols-outlined text-sm text-gray-500 dark:text-gray-400">edit</i>
                            Editar
                        </button>
                        <a href="{% url 'emprestimo:visualizar_emprestimo' emprestimo.id %}"
                           class="block w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 text-left">
                            <i class="material-symbols-outlined text-sm text-gray-500 dark:text-gray-400">visibility</i>
                            Visualizar
                        </a>
                        <button hx-get="{% url 'emprestimo:remover_emprestimo' emprestimo.id %}"
                                hx-confirm="Tem certeza que deseja remover?"
                                hx-swap="outerHTML"
                                hx-target="#tbody"
                                class="w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 text-left">
                            <i class="material-symbols-outlined text-sm text-gray-500 dark:text-gray-400">delete</i>
                            Remover
                        </button>
                    </div>
                </div>
            </td>
            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100">
                <a href="{% url 'ensino:editar_aluno' emprestimo.aluno_id %}"
                   class="group hover:text-blue-600 dark:hover:text-blue-400">
                    {{ emprestimo.aluno_nome }}
                    <span class="text-gray-600 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400">({{ emprestimo.aluno_matricula }})</span>
                </a>
            </td>
            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100">
                <a href="{% url 'patrimonio:editar_bem' emprestimo.bem_id %}"
                   class="group hover:text-blue-600 dark:hover:text-blue-400">
                    {{ emprestimo.bem_descricao }}
                    <span class="text-gray-600 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400">({{ emprestimo.bem_patrimonio }})</span>
                </a>
            </td>
            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100">{{ emprestimo.data_emprestimo|date:"d/m/Y" }}</td>
            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100">
                {{ emprestimo.data_devolucao_prevista|date:"d/m/Y" }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100">
                {% if emprestimo.data_devolucao %}
                    {{ emprestimo.data_devolucao|date:"d/m/Y" }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-100">
                <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium {% if emprestimo.estado == 1 %} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300 {% elif emprestimo.estado == 2 %} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300  {% else %} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 {% endif %}">
                    {{ emprestimo.estado.label }}
                </span>
            </td>
        </tr>
    {% empty %}
        <tr>
            <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400">Nenhum empréstimo encontrado.</td>
        </tr>
    {% endfor %}
</tbody>
